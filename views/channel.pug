extends layout

block title
    title #{channel.name} / MOVIER

block usermenu
    if state && state.home
        a.menu-item(href!=state.home)
            img(src="/images/icons/home.png")
            span My Channel

        a.menu-item(href='/auth/out')
            img(src="/images/icons/logout.png")
            span Log Out

block content
    script(src='/javascripts/connect.js' async)
    script(src='/javascripts/channelcontroller.js' async)

    -
        let numOfFilms = 0;
        channel.lists.map(x => numOfFilms += x.films.length);
        const numOfLists = channel.lists.length;
        const numOfFollowers = channel.followers.length;
        
    #left.custom-sized-left-user
        #back(style=`background-image: url('${channel.image}')`)

        #user
            img(src=channel.image)
            #name= channel.name
            #stat
                .stat-item
                    .num= numOfFilms
                    .stat-desc films
                .stat-item
                    .num= numOfLists
                    .stat-desc lists
                .stat-item
                    .num= numOfFollowers
                    .stat-desc followers

            #edit-button.button
                if state 
                    if state.owner
                        span.button-title(id=channel._id) EDIT
                    else
                        if state.isFollowed
                            span.button-title(onclick=`c_unfollow(this, '${channel.id}')`) UNFOLLOW
                        else
                            span.button-title(onclick=`c_follow(this, '${channel.id}')`) FOLLOW
                else
                    span.button-title(onclick="location.href='/'") FOLLOW

    #right
        #user-wrapper
            .block
                h1.block-title My lists
                .items
                    each list in channel.lists
                        a.item.list-item(href='/list/' + list.id)
                            img(src=list.cover)
                            .title(title=list.name)=list.name
            .block
                h1.block-title Saved lists
                .items
                    each list in channel.saved_lists
                        a.item.list-item(href='/list/' + list.id)
                            img(src=list.cover)
                            .title(title=list.name)=list.name
            .block
                h1.block-title Following
                .items
                    each elem in channel.following
                        a.item.channel-item(href='/channel/' + elem.id)
                            img(src=elem.image)
                            .title(title=elem.name)=elem.name
